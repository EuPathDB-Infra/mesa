'use strict';var _createClass=function(){function defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=require('react'),_react2=_interopRequireDefault(_react),_Actions=require('../State/Actions'),_Events=require('../Utils/Events'),_Events2=_interopRequireDefault(_Events),_Icon=require('../Components/Icon'),_Icon2=_interopRequireDefault(_Icon),_Toggle=require('../Components/Toggle'),_Toggle2=_interopRequireDefault(_Toggle),_Utils=require('../Utils/Utils'),_Utils2=_interopRequireDefault(_Utils);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var ColumnFilter=function(_React$PureComponent){function ColumnFilter(props){_classCallCheck(this,ColumnFilter);var _this=_possibleConstructorReturn(this,(ColumnFilter.__proto__||Object.getPrototypeOf(ColumnFilter)).call(this,props));return _this.openMenu=_this.openMenu.bind(_this),_this.clearAll=_this.clearAll.bind(_this),_this.selectAll=_this.selectAll.bind(_this),_this.renderMenu=_this.renderMenu.bind(_this),_this.toggleFilter=_this.toggleFilter.bind(_this),_this.renderTrigger=_this.renderTrigger.bind(_this),_this.renderMenuItem=_this.renderMenuItem.bind(_this),_this.componentDidMount=_this.componentDidMount.bind(_this),_this.handleTriggerClick=_this.handleTriggerClick.bind(_this),_this.updateFilterableValues=_this.updateFilterableValues.bind(_this),_this.componentWillReceiveProps=_this.componentWillReceiveProps.bind(_this),_this.state={filterableValues:[],touched:!1},_this}return _inherits(ColumnFilter,_React$PureComponent),_createClass(ColumnFilter,[{key:'openMenu',value:function openMenu(){var _this2=this,_props=this.props,column=_props.column,dispatch=_props.dispatch,filterState=column.filterState;if(!filterState.visible){var touched=this.state.touched;dispatch((0,_Actions.toggleColumnFilterVisibility)(column)),touched||filterState.enabled||(dispatch((0,_Actions.toggleColumnFilter)(column)),this.setState({touched:!0})),this.filterCloseListener=_Events2.default.add('click',function(e){var within=e.path.includes(_this2.refs.menu);within||_this2.closeMenu()})}}},{key:'closeMenu',value:function closeMenu(){var _props2=this.props,column=_props2.column,dispatch=_props2.dispatch;column.filterState.visible&&this.filterCloseListener&&(dispatch((0,_Actions.toggleColumnFilterVisibility)(column)),_Events2.default.remove(this.filterCloseListener))}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(newProps){var column=newProps.column,rows=newProps.rows;column===this.props.column&&rows===this.props.rows||this.updateFilterableValues()}},{key:'componentDidMount',value:function componentDidMount(){this.updateFilterableValues()}},{key:'updateFilterableValues',value:function updateFilterableValues(){var _props3=this.props,column=_props3.column,state=_props3.state,filterableValues=Array.from(new Set(state.rows.map(function(row){return row[column.key]})));this.setState({filterableValues:filterableValues})}},{key:'handleTriggerClick',value:function handleTriggerClick(){var _props4=this.props,column=_props4.column,dispatch=_props4.dispatch;if(column.filterable){var filterState=column.filterState;return filterState.visible?this.closeMenu():this.openMenu()}}},{key:'renderTrigger',value:function renderTrigger(){var _props5=this.props,column=_props5.column,state=_props5.state,filterState=column.filterState,icon='filter '+(filterState.enabled?'active':'inactive'),trigger=column.filterable?_react2.default.createElement(_Icon2.default,{fa:icon+' Trigger FilterTrigger',onClick:this.handleTriggerClick}):null;return trigger}},{key:'toggleValue',value:function toggleValue(value){var _props6=this.props,column=_props6.column,dispatch=_props6.dispatch;dispatch((0,_Actions.toggleColumnFilterValue)(column,value))}},{key:'toggleFilter',value:function toggleFilter(){var _props7=this.props,column=_props7.column,dispatch=_props7.dispatch;dispatch((0,_Actions.toggleColumnFilter)(column))}},{key:'selectAll',value:function selectAll(){var _props8=this.props,dispatch=_props8.dispatch,column=_props8.column,filterableValues=this.state.filterableValues;dispatch((0,_Actions.setColumnBlackList)(column,[]))}},{key:'clearAll',value:function clearAll(){var _props9=this.props,dispatch=_props9.dispatch,column=_props9.column,filterableValues=this.state.filterableValues;dispatch((0,_Actions.setColumnBlackList)(column,[].concat(_toConsumableArray(filterableValues))))}},{key:'renderMenuItem',value:function renderMenuItem(value){var _this3=this,_props$column$filterS=this.props.column.filterState,blacklist=_props$column$filterS.blacklist,enabled=_props$column$filterS.enabled,checkbox=blacklist.includes(value)?'square':'check-square';return _react2.default.createElement('div',{key:value,onClick:function onClick(){return _this3.toggleValue(value)}},_react2.default.createElement(_Icon2.default,{fa:checkbox,className:enabled?'':'disabled'}),' ',value)}},{key:'renderMenu',value:function renderMenu(){var _props10=this.props,state=_props10.state,column=_props10.column,filterable=column.filterable,filterState=column.filterState,filterableValues=this.state.filterableValues,blacklist=filterState.blacklist,enabled=filterState.enabled,visible=filterState.visible,items=filterableValues.map(this.renderMenuItem),menu=filterable&&visible?_react2.default.createElement('div',{className:'FilterMenu',ref:'menu'},_react2.default.createElement('big',null,_react2.default.createElement('b',null,column.name),' filter',_react2.default.createElement('span',{className:'faded'},' (',enabled?'on':'off',')'),_react2.default.createElement(_Toggle2.default,{style:{float:'right'},onChange:this.toggleFilter,enabled:enabled})),_react2.default.createElement('div',null,_react2.default.createElement('a',{onClick:this.selectAll},'Select All'),' | ',_react2.default.createElement('a',{onClick:this.clearAll},'Clear All')),_react2.default.createElement('div',{className:'FilterMenu-CheckList'},items)):null;return menu}},{key:'render',value:function render(){var trigger=this.renderTrigger(),menu=this.renderMenu();return _react2.default.createElement('div',{className:'ColumnFilter-Wrapper'},trigger,menu)}}]),ColumnFilter}(_react2.default.PureComponent);exports.default=ColumnFilter;